<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>AirbitzCore Sample App</title>
      <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  </head>
  <body>
    <nav class="navbar navbar-default">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Airbitz Sample</a>
        </div>
        <div id="navbar">
          <!--<form class="navbar-form navbar-left">-->
              <!--<div class="form-group">-->
                <!--<input type="text" id="apiKey" class="form-control" placeholder="API key">-->
              <!--</div>-->
              <!--<button type="button" id="apiKeySubmit" class="btn btn-default">Submit</button>-->
          <!--</form>-->
          <ul class="nav navbar-nav navbar-right logged_out">
              <li><a href="javascript://" id="login">Login</a></li>
              <li><a href="javascript://" id="register">Register</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right logged_in" style="display:hidden">
              <li><a href="javascript://" id="account">Manage Account</a></li>
              <li><a href="javascript://" id="logout">Logout</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container logged_out">
      <div class="text-center">
          <h2>Welcome to the Airbitz Javascript Core Demo Webapp</h2>
          <p>This is a sample web app that implements the <b>airbitz-core-js-ui</b> library for account authentication and private key management</p>
          <p>You are currently logged out</p>
          <p>Please click [Login] or [Register].</p>
      </div>
    </div>
    <div class="container logged_in" style="display:hidden">
      <table class="table table-striped">
          <tr>
              <td colspan="2"><b>Congratulation! You are logged in via Airbitz</b></td>
          </tr>
        <tr>
          <td>Username:</td>
          <td><span id="username"></span></td>
        </tr>
        <tr>
          <td>Root Key:</td>
          <td><span id="key"></span></td>
        </tr>
      </table>
    </div>
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/abcui/assets/js/abcui.js"></script>
    <script>
        var _account = null;
        var _abcUi = null;
        // Replace 'd98e26ce95d1a1ceb76be0f373fd2b1af29335e8' with your own API key from https://developer.airbitz.co
        _abcUi = abcui.makeABCUIContext({
            'apiKey': 'd98e26ce95d1a1ceb76be0f373fd2b1af29335e8',
            'accountType': 'account:repo:com.mydomain.myapp',
            'bundlePath': '/abcui',
            'vendorName': 'AirbitzUITest'
        });
        function updateUi() {
          if (_abcUi == null) {
            $('.logged_out').hide();
            $('.logged_in').hide();
          } else if (_account == null) {
            $('.logged_out').show();
            $('.logged_in').hide();
          } else {
            $('.logged_out').hide();
            $('.logged_in').show();
            $('#username').text(_account.username);
            $('#key').text(_account.rootKey.toString('base64'));
          }
        }
//        $(function() {
//          $('#apiKeySubmit').click(function() {
//            _abcUi = abcui.AbcUi({'key': $('#apiKey').val(), 'bundle-path': '/ui'});
            $('#login').click(function() {
              _abcUi.openLoginWindow(function(error, account) {
                _account = account;
                updateUi();
              });
            });
            $('#register').click(function() {
              _abcUi.openRegisterWindow(function(error, account) {
                _account = account;
                updateUi();
              });
            });
            $('#logout').click(function() {
              _account.logout();
              _account = null;
              updateUi();
            });
            $('#account').click(function() {
              _abcUi.openManageWindow(_account, function(error) {
                updateUi();
              });
            });
            updateUi();
//        });
//        updateUi();
//      });
    </script>
  </body>
</html>
